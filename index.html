/* calcul badge */
async function updateBell(){

  try{

    const res = await fetch(API_URL,{cache:"no-store"});
    const data = await res.json();

    if(!Array.isArray(data)) return;

    const today = new Date();
    today.setHours(0,0,0,0);

    const lues = getLues();
    let count = 0;

    data
      .filter(n => {

        if(n.epingle === "oui") return true;

        if(n.active !== "oui") return false;

        // si pas d'expire → vérifier la date
        if(!n.expire){
          const d = parseDateFR(n.date);
          if(!d) return true;
          return d >= today;
        }

        // sinon vérifier expiration
        const exp = parseDateFR(n.expire);
        if(!exp) return true;
        return exp >= today;
      })
      .forEach(n=>{
        if(!lues.includes(n.id)){
          count++;
        }
      });

    const badge=document.getElementById("bellBadge");

    if(count>0){
      badge.style.display="flex";
      badge.textContent=count;
    }else{
      badge.style.display="none";
    }

  }catch(e){
    console.log("Erreur cloche :",e);
  }

}
