<script>

const API_URL="https://script.googleusercontent.com/macros/echo?user_content_key=AY5xjrRY09nECq5kqJEPaFCkMRnR4qbM-Z9y5KOMgVdlakJAA_L1FlwHMDN84Nstw8qXhqpt9QHGCeU6Sr6aLk3y7hSeA-1vr_eBBQYFwVL111h-CJZc8JxRQKvcu3XE7Gg-OXbXE8Vkp1PlAMHAkhJduQw6bxUswIvR7b1rA8txQ2Rtyl25eNxQWvtBet3bytcH6RpMKvJdyZcSioOtKa5sYL4uRI4FOoFrfUzX5P_pjpK-cAN8Bdf6otVcK4myQl66GohjWiPVOyCuofXOq8M4lQkmsxucwQ&lib=MfQh9XKIUpdlMRcOJ4l9JImAGFOlNCMp3";
const STORAGE_KEY="alerts_lues";

const id=new URLSearchParams(window.location.search).get("id");

function parseDateFR(str){
 if(!str) return null;
 const [d,m,y]=str.split("/");
 return new Date(y,m-1,d,12,0,0);
}

function marquerLu(id){
 const lues=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
 if(!lues.includes(id)){
   lues.push(id);
   localStorage.setItem(STORAGE_KEY,JSON.stringify(lues));
 }
}

async function loadDetail(){

try{
 const res=await fetch(API_URL);
 const data=await res.json();
 const n=data.find(x=>String(x.id)===String(id));

 const today=new Date();
 today.setHours(0,0,0,0);

 if(!n){
   titre.innerText="Notification introuvable";
 }
 else{
   const d=parseDateFR(n.expire || n.date);

   const autorisee=
     n.active==="oui" &&
     (n.epingle==="oui" || !d || d>=today);

   if(!autorisee){
     titre.innerText="Cette notification nâ€™est plus disponible.";
   }else{
     marquerLu(n.id);
     titre.innerText=n.titre;
     categorie.innerText=n.categorie||"";
     heure.innerText=n.heure||"";
     message.innerText=n.message||"";
   }
 }

}catch(e){console.log(e);}

loader.style.display="none";
content.style.display="block";
}

function goBack(){history.back();}
loadDetail();

</script>
